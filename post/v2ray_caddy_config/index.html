<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.58.3" />

  <title>V2ray &amp; Caddy Configuration &middot; CORNER OF THE WORLD</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://lovector.me/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://lovector.me/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://lovector.me/css/blackburn.css">
  <link rel="stylesheet" href="https://lovector.me/css/mine.css">

  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  
  <link rel="alternate" type="application/rss+xml" title="CORNER OF THE WORLD"
    href='https://lovector.me/post/v2ray_caddy_config/index.xml' />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://lovector.me/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://lovector.me/css/my.css">
    
  
  
    
        <script src="https://lovector.me/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://lovector.me/">LOVECTOR</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://lovector.me/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://lovector.me/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://lovector.me/tags/"><i class='fa fa-tag fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://lovector.me/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href='https://lovector.me/post/v2ray_caddy_config/index.xml'><i
          class="fas fa-rss fa-fw"></i>RSS</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/isees" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2018. All rights reserved.</small>
  </div>
  
    
    
  
</div>

</div>


  <div id="main">


<div class="header">
  <h1>V2ray &amp; Caddy Configuration</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>07 May 2020, 20:24</time>
  </div>

  

  
  
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://lovector.me/tags/v2ray">v2ray</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://lovector.me/tags/caddy">caddy</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://lovector.me/tags/ubuntu">ubuntu</a>
    
  </div>
  
  

</div>

  

<h2 id="01-v2ray">#01 V2ray</h2>

<hr />

<h3 id="install-v2ray">Install V2ray</h3>

<pre><code>bash &lt;(curl -L -s https://install.direct/go.sh)
</code></pre>

<h3 id="config-v2ray">Config V2ray</h3>

<p>vim /etc/v2ray/config.json</p>

<pre><code>{
    &quot;log&quot;: {
        &quot;access&quot;: &quot;/var/log/v2ray/access.log&quot;,
        &quot;error&quot;: &quot;/var/log/v2ray/error.log&quot;,
        &quot;loglevel&quot;: &quot;warning&quot;
        //&quot;loglevel&quot;: &quot;none&quot;
    },
    &quot;inbound&quot;: {
        &quot;port&quot;: 8280,
        &quot;protocol&quot;: &quot;vmess&quot;,
        &quot;settings&quot;: {
            &quot;clients&quot;: [
                {
                    &quot;id&quot;: &quot;43d486e2-9xxf-f347-c08f-1284d3676844&quot;,
                    &quot;level&quot;: 1,
                    &quot;alterId&quot;: 64
                }
            ]
        },
        &quot;streamSettings&quot;: {
            &quot;network&quot;: &quot;ws&quot;,
            &quot;wsSettings&quot;: {
                &quot;path&quot;:&quot;/path&quot;
            }
        },
        &quot;detour&quot;: {
            &quot;to&quot;: &quot;vmess-detour-471335&quot;
        }
    },
    &quot;outbound&quot;: {
        &quot;protocol&quot;: &quot;freedom&quot;,
        &quot;settings&quot;: {}
    }
}
</code></pre>

<h3 id="start-v2ray">Start v2ray</h3>

<pre><code class="language-bash">$ systemctl start v2ray
$ systemctl status v2ray
</code></pre>

<h2 id="02-caddy">#02 Caddy</h2>

<hr />

<h3 id="install-caddy">Install Caddy</h3>

<pre><code>curl https://getcaddy.com | bash -s personal        //安装getcaddy
which caddy                                         //查看安装位置
caddy -version                                      //查看版本
</code></pre>

<h3 id="config-caddy">Config Caddy</h3>

<p>create a file named &ldquo;Caddyfile&rdquo; in /etc/caddy/</p>

<pre><code>xxx.xxx.com
 {
         root /var/www/
         tls name@xxx.com
         log /var/log/caddy/caddy.log
         proxy /path localhost:8280 {
                 websocket
                 header_upstream -Origin
         }
 }
</code></pre>

<h3 id="install-caddy-service">Install Caddy service</h3>

<pre><code>vim /etc/systemd/system/caddy.service
</code></pre>

<pre><code># caddy.service
#
# For using Caddy with a config file.
#
# Make sure the ExecStart and ExecReload commands are correct
# for your installation.
#
# See https://caddyserver.com/docs/install for instructions.
#
# WARNING: This service does not use the --resume flag, so if you
# use the API to make changes, they will be overwritten by the
# Caddyfile next time the service is restarted. If you intend to
# use Caddy's API to configure it, add the --resume flag to the
# `caddy run` command or use the caddy-api.service file instead.

[Unit]
Description=Caddy
Documentation=https://caddyserver.com/docs/
After=network.target

[Service]
User=www-data
Group=www-data
ExecStart=/usr/local/bin/caddy -log stdout -log-timestamps=false -agree=true -conf=/etc/caddy/Caddyfile -root=/var/tmp
ExecReload=/bin/kill -USR1 $MAINPID
TimeoutStopSec=5s
LimitNOFILE=1048576
LimitNPROC=512
PrivateTmp=true
ProtectSystem=full
AmbientCapabilities=CAP_NET_BIND_SERVICE

[Install]
WantedBy=multi-user.target
</code></pre>

<h3 id="reload-run">Reload &amp; Run</h3>

<pre><code class="language-bash">$ systemctl daemon-reload
$ systemctl start caddy
$ systemctl status caddy
</code></pre>

<h2 id="03-enable-bbr">#03 Enable BBR</h2>

<p>Input <em>uname -r</em> to see whether the core version is not less than 4.9</p>

<p>Run <em>lsmod | grep bbr</em>, if there&rsquo;s no <em>tcp_bbr</em> then run:</p>

<pre><code>sudo modprobe tcp_bbr
echo &quot;tcp_bbr&quot; | sudo tee --append /etc/modules-load.d/modules.conf
</code></pre>

<p>Run</p>

<pre><code>echo &quot;net.core.default_qdisc=fq&quot; | sudo tee --append /etc/sysctl.conf
echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; | sudo tee --append /etc/sysctl.conf
</code></pre>

<p>Save config</p>

<pre><code>sudo sysctl -p
</code></pre>

<p>Run</p>

<pre><code>sysctl net.ipv4.tcp_available_congestion_control
sysctl net.ipv4.tcp_congestion_control
</code></pre>

<p>Run <em>lsmod | grep bbr</em>, if you see <em>tcp_bbr</em> then it means BBR is startup.</p>

<h2 id="04-references">#04 References</h2>

<ul>
<li><a href="https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AF-TCP-BBR-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95">开启 TCP BBR 拥塞控制算法</a></li>
</ul>

  
  

	
	
	
	
	
	
	
	
	
	
	
	



<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}
	ul.share-buttons li{
	  display: inline;
	}
	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://lovector.me/post/homebrew_china_mirror/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://lovector.me/post/homebrew_china_mirror/">Homebrew 国内镜像切换</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'lovector';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="https://lovector.me/js/ui.js"></script>
<script src="https://lovector.me/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-114659566-1', 'auto');
    ga('send', 'pageview');
  }
</script>





<script src="https://lovector.me/js/math-code.js"></script>
  <script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

